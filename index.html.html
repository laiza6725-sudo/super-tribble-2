<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>FoodTracker</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #1c1c1e;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            padding-top: 10px;
            min-height: 100vh;
        }

        .app-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #48484a;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #c6c6c8;
            border-radius: 10px;
            font-size: 16px;
            -webkit-appearance: none;
            appearance: none;
            min-height: 44px;
            background-color: white;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            width: 100%;
            cursor: pointer;
            min-height: 44px;
            transition: background-color 0.2s;
            font-weight: 600;
        }

        button:active {
            background-color: #0056cc;
            transform: scale(0.98);
        }

        .ingredient-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .ingredient-name {
            flex: 2;
        }

        .ingredient-amount {
            flex: 1;
        }

        .ingredient-unit {
            flex: 1;
            min-width: 100px;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007aff%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 35px;
        }

        .ingredient-price {
            flex: 1;
            min-width: 100px;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007aff;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–ª–∏—Ç–æ–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤ */
        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .recipe-tile {
            border-radius: 16px;
            padding: 15px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            height: 160px;
            position: relative;
            overflow: hidden;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
        }

        .recipe-tile:active {
            transform: scale(0.98);
        }

        .recipe-tile-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.3;
            z-index: 0;
        }

        .recipe-tile-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            justify-content: space-between;
        }

        .recipe-tile-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1c1c1e;
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .recipe-tile-category {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.7);
            color: #1c1c1e;
            align-self: flex-start;
        }

        .recipe-tile-info {
            font-size: 12px;
            color: #48484a;
            margin-top: auto;
        }

        .recipe-tile-cost {
            font-weight: bold;
            color: #34c759;
            margin-top: 5px;
        }

        .recipe-tile-rating {
            margin-top: 5px;
            font-size: 14px;
        }

        .stars {
            color: #ffcc00;
        }

        .delete-tile-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255,255,255,0.8);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            font-size: 14px;
            color: #ff3b30;
        }

        .tab-container {
            display: flex;
            margin-bottom: 20px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: sticky;
            top: 10px;
            z-index: 100;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 14px 8px;
            background: white;
            border: none;
            font-size: 14px;
            font-weight: 500;
            color: #8e8e93;
            transition: all 0.2s ease;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            min-height: 44px;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
        }

        .tab.active {
            background: white;
            color: #007aff;
            border-bottom: 3px solid #007aff;
        }

        .tab:active {
            background: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .image-upload {
            text-align: center;
            border: 2px dashed #c6c6c8;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            transition: background-color 0.2s;
        }

        .image-upload:active {
            background-color: #f8f9fa;
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 12px;
            margin-top: 10px;
            display: none;
        }

        .photo-btn {
            background: #5856d6;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .photo-btn:active {
            background: #4745c4;
        }

        .camera-icon, .gallery-icon {
            font-size: 20px;
        }

        .photo-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .photo-options button {
            flex: 1;
        }

        .analysis-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            background: #f8f9fa;
        }

        .rating {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }

        .rating.excellent {
            color: #34c759;
        }

        .rating.good {
            color: #ffcc00;
        }

        .rating.poor {
            color: #ff3b30;
        }

        .macro-bar {
            height: 8px;
            border-radius: 4px;
            margin: 5px 0;
            background: #e5e5ea;
            overflow: hidden;
        }

        .macro-fill {
            height: 100%;
            border-radius: 4px;
        }

        .protein-fill {
            background: #007aff;
        }

        .fat-fill {
            background: #ff9500;
        }

        .carbs-fill {
            background: #34c759;
        }

        .macro-labels {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-top: 5px;
        }

        .recommendations {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #007aff;
        }

        .recommendations h4 {
            margin-bottom: 5px;
            color: #48484a;
        }

        .health-score {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        .score-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
        }

        .score-excellent {
            background: #34c759;
        }

        .score-good {
            background: #ffcc00;
        }

        .score-poor {
            background: #ff3b30;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ—Ü–µ–ø—Ç–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 20px auto;
            padding: 20px;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            color: #8e8e93;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #f2f2f7;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
        }

        .close-modal:active {
            background: #e5e5ea;
        }

        .modal-recipe-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .modal-section {
            margin-bottom: 20px;
        }

        .modal-section h3 {
            margin-bottom: 10px;
            color: #1c1c1e;
            border-bottom: 1px solid #e5e5ea;
            padding-bottom: 5px;
        }

        .instructions-text {
            white-space: pre-line;
            line-height: 1.5;
        }

        .ingredients-list {
            list-style-type: none;
            padding-left: 0;
        }

        .ingredients-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f2f2f7;
        }

        .ingredients-list li:last-child {
            border-bottom: none;
        }

        .nutrition-facts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .nutrition-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .nutrition-value {
            font-weight: bold;
            font-size: 18px;
            color: #007aff;
        }

        .nutrition-label {
            font-size: 12px;
            color: #8e8e93;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #8e8e93;
        }

        .empty-state p {
            margin-top: 10px;
        }

        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 500px) {
            body {
                padding: 15px;
            }
            
            .app-container {
                padding: 15px;
            }
            
            .tab {
                padding: 16px 8px;
                font-size: 15px;
            }
            
            .recipe-tile {
                height: 170px;
            }
            
            .photo-options {
                flex-direction: column;
            }
            
            .ingredient-row {
                flex-direction: column;
                gap: 8px;
            }
            
            .ingredient-name, .ingredient-amount, .ingredient-unit, .ingredient-price {
                width: 100%;
            }
        }

        /* –£–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –Ω–∞ iOS */
        select {
            cursor: pointer;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .tab-content {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .cost-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
        }

        .cost-summary h4 {
            margin-bottom: 10px;
            color: #48484a;
        }

        .cost-breakdown {
            margin-top: 10px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #e5e5ea;
        }

        .cost-item:last-child {
            border-bottom: none;
        }

        .total-cost {
            font-weight: bold;
            color: #34c759;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #e5e5ea;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>ü•ó FoodTracker</h1>
            <p>–£—á–µ—Ç –ø–∏—Ç–∞–Ω–∏—è –∏ –≤–∏—Ç–∞–º–∏–Ω–æ–≤</p>
        </div>

        <div class="tab-container">
            <button class="tab active" data-tab="add">–î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="tab" data-tab="recipes">–†–µ—Ü–µ–ø—Ç—ã</button>
            <button class="tab" data-tab="stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab" data-tab="analysis">–ê–Ω–∞–ª–∏–∑</button>
        </div>

        <div id="add-tab" class="tab-content active">
            <div class="card">
                <h2>–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç</h2>
                <div class="input-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞</label>
                    <input type="text" id="recipeName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ì—Ä–µ—á–Ω–µ–≤–∞—è –∫–∞—à–∞ —Å –æ–≤–æ—â–∞–º–∏">
                </div>
                
                <div class="input-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="category">
                        <option value="breakfast">–ó–∞–≤—Ç—Ä–∞–∫</option>
                        <option value="lunch">–û–±–µ–¥</option>
                        <option value="dinner">–£–∂–∏–Ω</option>
                        <option value="snack">–ü–µ—Ä–µ–∫—É—Å</option>
                        <option value="dessert">–î–µ—Å–µ—Ä—Ç</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>–§–æ—Ç–æ —Ä–µ—Ü–µ–ø—Ç–∞</label>
                    <div class="image-upload" id="imageUpload">
                        <p>üì∑ –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</p>
                        <img id="imagePreview" class="image-preview" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
                    </div>
                    <input type="file" id="imageInput" accept="image/*" capture="environment" style="display: none;">
                    <div class="photo-options">
                        <button type="button" class="photo-btn" id="cameraBtn">
                            <span class="camera-icon">üì∑</span> –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ
                        </button>
                        <button type="button" class="photo-btn" id="galleryBtn">
                            <span class="gallery-icon">üñºÔ∏è</span> –í—ã–±—Ä–∞—Ç—å –∏–∑ –≥–∞–ª–µ—Ä–µ–∏
                        </button>
                    </div>
                </div>

                <div class="input-group">
                    <label>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã (—É–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É –∑–∞ 100–≥/–º–ª)</label>
                    <div id="ingredients">
                        <div class="ingredient-row">
                            <input type="text" placeholder="–ü—Ä–æ–¥—É–∫—Ç" class="ingredient-name">
                            <input type="number" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" class="ingredient-amount" value="100">
                            <select class="ingredient-unit">
                                <option value="g">–≥</option>
                                <option value="ml">–º–ª</option>
                                <option value="tsp">—á.–ª.</option>
                                <option value="tbsp">—Å—Ç.–ª.</option>
                                <option value="cup">—Å—Ç–∞–∫–∞–Ω</option>
                                <option value="piece">—à—Ç.</option>
                            </select>
                            <input type="number" placeholder="–¶–µ–Ω–∞ –∑–∞ 100–≥/–º–ª" class="ingredient-price" step="0.01" min="0">
                        </div>
                    </div>
                    <button type="button" onclick="addIngredient()" style="background: #34c759; margin-top: 10px;">+ –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</button>
                </div>

                <div class="input-group">
                    <label>–°–ø–æ—Å–æ–± –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</label>
                    <textarea id="instructions" placeholder="–û–ø–∏—à–∏—Ç–µ —à–∞–≥–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –±–ª—é–¥–∞..."></textarea>
                </div>

                <button type="button" onclick="addRecipe()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç</button>
            </div>
        </div>

        <div id="recipes-tab" class="tab-content">
            <div class="card">
                <h2>–ú–æ–∏ —Ä–µ—Ü–µ–ø—Ç—ã</h2>
                <div id="recipesList" class="recipes-grid">
                    <!-- –ü–ª–∏—Ç–∫–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>

        <div id="stats-tab" class="tab-content">
            <div class="card">
                <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalCalories">0</div>
                        <div>–ö–∞–ª–æ—Ä–∏–∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalIron">0</div>
                        <div>–ñ–µ–ª–µ–∑–æ (–º–≥)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalProtein">0</div>
                        <div>–ë–µ–ª–æ–∫ (–≥)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalCarbs">0</div>
                        <div>–£–≥–ª–µ–≤–æ–¥—ã (–≥)</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>–ü—Ä–æ–¥—É–∫—Ç—ã –≤ –±–∞–∑–µ</h2>
                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤:</p>
                <ul id="foodList" style="margin-top: 10px; padding-left: 20px;">
                    <!-- –°–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω JavaScript -->
                </ul>
            </div>
        </div>

        <div id="analysis-tab" class="tab-content">
            <div class="card">
                <h2>–ê–Ω–∞–ª–∏–∑ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Ü–µ–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –µ–≥–æ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏:</p>
                
                <div class="input-group">
                    <label>–†–µ—Ü–µ–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</label>
                    <select id="analysisRecipe">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Ü–µ–ø—Ç --</option>
                    </select>
                </div>
                
                <div id="analysisResult" class="analysis-result" style="display: none;">
                    <div class="health-score">
                        <div id="scoreCircle" class="score-circle">0</div>
                        <div>
                            <h3 id="healthRating">–û—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏</h3>
                            <p id="healthDescription">–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏</p>
                        </div>
                    </div>
                    
                    <div class="recipe-rating-stars">
                        <h4>–û—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏:</h4>
                        <div id="starRating" class="stars" style="font-size: 24px; text-align: center; margin: 10px 0;"></div>
                    </div>
                    
                    <h4>–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ë–ñ–£:</h4>
                    <div class="macro-bar">
                        <div id="proteinBar" class="macro-fill protein-fill" style="width: 0%"></div>
                    </div>
                    <div class="macro-labels">
                        <span>–ë–µ–ª–∫–∏: <span id="proteinPercent">0%</span></span>
                        <span id="proteinWeight">0–≥</span>
                    </div>
                    
                    <div class="macro-bar">
                        <div id="fatBar" class="macro-fill fat-fill" style="width: 0%"></div>
                    </div>
                    <div class="macro-labels">
                        <span>–ñ–∏—Ä—ã: <span id="fatPercent">0%</span></span>
                        <span id="fatWeight">0–≥</span>
                    </div>
                    
                    <div class="macro-bar">
                        <div id="carbsBar" class="macro-fill carbs-fill" style="width: 0%"></div>
                    </div>
                    <div class="macro-labels">
                        <span>–£–≥–ª–µ–≤–æ–¥—ã: <span id="carbsPercent">0%</span></span>
                        <span id="carbsWeight">0–≥</span>
                    </div>
                    
                    <div class="recommendations">
                        <h4>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
                        <div id="recommendationsList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ—Ü–µ–ø—Ç–∞ -->
        <div id="recipeModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeModal()">&times;</span>
                <div id="modalContent">
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–Ω–∞ 100–≥)
        const foodDatabase = {
            '–≥–æ–≤—è–¥–∏–Ω–∞': { calories: 250, iron: 2.6, protein: 26, carbs: 0, fat: 15 },
            '—à–ø–∏–Ω–∞—Ç': { calories: 23, iron: 2.7, protein: 2.9, carbs: 3.6, fat: 0.4 },
            '—á–µ—á–µ–≤–∏—Ü–∞': { calories: 116, iron: 3.3, protein: 9, carbs: 20, fat: 0.4 },
            '–∫—É—Ä–∏—Ü–∞': { calories: 165, iron: 1.0, protein: 31, carbs: 0, fat: 3.6 },
            '—è–±–ª–æ–∫–æ': { calories: 52, iron: 0.1, protein: 0.3, carbs: 14, fat: 0.2 },
            '–≥—Ä–µ—á–∫–∞': { calories: 343, iron: 2.2, protein: 13, carbs: 72, fat: 3.4 },
            '—è–π—Ü–æ': { calories: 155, iron: 1.2, protein: 13, carbs: 1.1, fat: 11 },
            '—Ç—É–Ω–µ—Ü': { calories: 184, iron: 1.0, protein: 30, carbs: 0, fat: 6 },
            '–±—Ä–æ–∫–∫–æ–ª–∏': { calories: 34, iron: 0.7, protein: 2.8, carbs: 7, fat: 0.4 },
            '–≥—Ä–∞–Ω–∞—Ç': { calories: 83, iron: 0.3, protein: 1.7, carbs: 19, fat: 1.2 },
            '–ø–µ—á–µ–Ω—å': { calories: 135, iron: 6.5, protein: 20, carbs: 3, fat: 3.7 },
            '—Ñ–∞—Å–æ–ª—å': { calories: 127, iron: 2.5, protein: 9, carbs: 22, fat: 0.5 },
            '–º–æ—Ä–∫–æ–≤—å': { calories: 41, iron: 0.3, protein: 0.9, carbs: 10, fat: 0.2 },
            '—Ä–∏—Å': { calories: 130, iron: 0.4, protein: 2.7, carbs: 28, fat: 0.3 },
            '—Ç–≤–æ—Ä–æ–≥': { calories: 98, iron: 0.1, protein: 11, carbs: 3, fat: 4.3 },
            '–º–æ–ª–æ–∫–æ': { calories: 42, iron: 0.0, protein: 3.4, carbs: 5, fat: 1 },
            '–±–∞–Ω–∞–Ω': { calories: 89, iron: 0.3, protein: 1.1, carbs: 23, fat: 0.3 },
            '–∞–≤–æ–∫–∞–¥–æ': { calories: 160, iron: 0.6, protein: 2, carbs: 9, fat: 15 },
            '–ª–æ—Å–æ—Å—å': { calories: 208, iron: 0.3, protein: 20, carbs: 0, fat: 13 },
            '—Å—ã—Ä': { calories: 402, iron: 0.7, protein: 25, carbs: 1.3, fat: 33 },
            '–æ–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ': { calories: 884, iron: 0.6, protein: 0, carbs: 0, fat: 100 },
            '—Å–∞—Ö–∞—Ä': { calories: 387, iron: 0.1, protein: 0, carbs: 100, fat: 0 },
            '–º–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ': { calories: 717, iron: 0.2, protein: 0.9, carbs: 0.1, fat: 81 },
            '–æ—Ä–µ—Ö–∏ –≥—Ä–µ—Ü–∫–∏–µ': { calories: 654, iron: 2.9, protein: 15, carbs: 14, fat: 65 },
            '–æ–≤—Å—è–Ω–∫–∞': { calories: 389, iron: 4.7, protein: 17, carbs: 66, fat: 7 },
            '–≤–æ–¥–∞': { calories: 0, iron: 0, protein: 0, carbs: 0, fat: 0 },
            '—Å–æ–ª—å': { calories: 0, iron: 0.1, protein: 0, carbs: 0, fat: 0 },
            '–ø–µ—Ä–µ—Ü': { calories: 251, iron: 7.8, protein: 10.4, carbs: 64, fat: 3.3 },
            '–º—É–∫–∞': { calories: 364, iron: 1.2, protein: 10, carbs: 76, fat: 1 }
        };

        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤ –≥—Ä–∞–º–º—ã
        const unitConversions = {
            'g': 1,        // –≥—Ä–∞–º–º—ã
            'ml': 1,       // –º–∏–ª–ª–∏–ª–∏—Ç—Ä—ã (–¥–ª—è –≤–æ–¥—ã –∏ –∂–∏–¥–∫–æ—Å—Ç–µ–π —Å –ø–ª–æ—Ç–Ω–æ—Å—Ç—å—é ~1 –≥/–º–ª)
            'tsp': 5,      // —á–∞–π–Ω–∞—è –ª–æ–∂–∫–∞ (~5 –≥)
            'tbsp': 15,    // —Å—Ç–æ–ª–æ–≤–∞—è –ª–æ–∂–∫–∞ (~15 –≥)
            'cup': 240,    // —Å—Ç–∞–∫–∞–Ω (~240 –≥)
            'piece': 1     // —à—Ç—É–∫–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–¥—É–∫—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å)
        };

        // –¶–≤–µ—Ç–∞ –¥–ª—è –ø–ª–∏—Ç–æ–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤
        const tileColors = [
            'linear-gradient(135deg, #FF9AA2, #FFB7B2)',
            'linear-gradient(135deg, #FFDAC1, #E2F0CB)',
            'linear-gradient(135deg, #B5EAD7, #C7CEEA)',
            'linear-gradient(135deg, #E2F0CB, #B5EAD7)',
            'linear-gradient(135deg, #C7CEEA, #FFDAC1)',
            'linear-gradient(135deg, #FFB7B2, #FF9AA2)',
            'linear-gradient(135deg, #B5EAD7, #E2F0CB)',
            'linear-gradient(135deg, #FFDAC1, #FFB7B2)',
            'linear-gradient(135deg, #C7CEEA, #B5EAD7)',
            'linear-gradient(135deg, #E2F0CB, #C7CEEA)'
        ];

        let recipes = JSON.parse(localStorage.getItem('recipes')) || [];
        let currentImageData = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            document.getElementById('imageUpload').addEventListener('click', function() {
                document.getElementById('imageInput').click();
            });
            
            document.getElementById('imageInput').addEventListener('change', handleImageSelect);
            
            document.getElementById('cameraBtn').addEventListener('click', function() {
                document.getElementById('imageInput').setAttribute('capture', 'environment');
                document.getElementById('imageInput').click();
            });
            
            document.getElementById('galleryBtn').addEventListener('click', function() {
                document.getElementById('imageInput').removeAttribute('capture');
                document.getElementById('imageInput').click();
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            showTab('add');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            updateRecipesList();
            calculateNutrition();
            updateFoodList();
        });

        function handleImageSelect(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentImageData = e.target.result;
                    document.getElementById('imagePreview').src = currentImageData;
                    document.getElementById('imagePreview').style.display = 'block';
                    document.getElementById('imageUpload').querySelector('p').textContent = 'üñºÔ∏è –§–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ';
                }
                reader.readAsDataURL(e.target.files[0]);
            }
        }

        function showTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            
            // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É —Ä–µ—Ü–µ–ø—Ç–æ–≤, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            if (tabName === 'recipes') {
                updateRecipesList();
            } else if (tabName === 'analysis') {
                updateAnalysisRecipeList();
            }
        }

        function updateAnalysisRecipeList() {
            const select = document.getElementById('analysisRecipe');
            select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Ü–µ–ø—Ç --</option>';
            
            recipes.forEach(recipe => {
                const option = document.createElement('option');
                option.value = recipe.id;
                option.textContent = recipe.name;
                select.appendChild(option);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞
            select.onchange = function() {
                analyzeSelectedRecipe();
            };
        }

        function analyzeSelectedRecipe() {
            const recipeId = parseInt(document.getElementById('analysisRecipe').value);
            if (!recipeId) {
                document.getElementById('analysisResult').style.display = 'none';
                return;
            }
            
            const recipe = recipes.find(r => r.id === recipeId);
            if (recipe) {
                analyzeRecipe(recipe);
            }
        }

        function analyzeRecipe(recipe) {
            let totalProtein = 0;
            let totalFat = 0;
            let totalCarbs = 0;
            let totalIron = 0;
            let totalCalories = 0;

            recipe.ingredients.forEach(ing => {
                const food = foodDatabase[ing.name];
                if (food) {
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –≥—Ä–∞–º–º—ã
                    const weightInGrams = ing.amount * unitConversions[ing.unit];
                    const ratio = weightInGrams / 100;
                    totalProtein += food.protein * ratio;
                    totalFat += food.fat * ratio;
                    totalCarbs += food.carbs * ratio;
                    totalIron += food.iron * ratio;
                    totalCalories += food.calories * ratio;
                }
            });

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã –ë–ñ–£ –æ—Ç –æ–±—â–µ–π –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏
            const proteinCalories = totalProtein * 4;
            const fatCalories = totalFat * 9;
            const carbsCalories = totalCarbs * 4;
            const totalMacroCalories = proteinCalories + fatCalories + carbsCalories;
            
            // –ü—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç –æ–±—â–µ–π –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏
            const proteinPercent = totalMacroCalories > 0 ? (proteinCalories / totalMacroCalories) * 100 : 0;
            const fatPercent = totalMacroCalories > 0 ? (fatCalories / totalMacroCalories) * 100 : 0;
            const carbsPercent = totalMacroCalories > 0 ? (carbsCalories / totalMacroCalories) * 100 : 0;

            // –û—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏
            let score = 100;
            let recommendations = [];

            // –û—Ü–µ–Ω–∏–≤–∞–µ–º –±–∞–ª–∞–Ω—Å –ë–ñ–£
            // –ò–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –¥–ª—è —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è: –ë:15-25%, –ñ:25-35%, –£:45-65%
            if (proteinPercent < 15) {
                score -= 15;
                recommendations.push("–î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –±–µ–ª–∫–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–º—è—Å–æ, —Ä—ã–±–∞, –±–æ–±–æ–≤—ã–µ)");
            } else if (proteinPercent > 30) {
                score -= 10;
                recommendations.push("–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –±–µ–ª–∫–∞, –¥–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –æ–≤–æ—â–µ–π –∏ —É–≥–ª–µ–≤–æ–¥–æ–≤");
            }

            if (fatPercent < 20) {
                score -= 10;
                recommendations.push("–î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∂–∏—Ä—ã (–∞–≤–æ–∫–∞–¥–æ, –æ—Ä–µ—Ö–∏, –æ–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ)");
            } else if (fatPercent > 40) {
                score -= 15;
                recommendations.push("–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∂–∏—Ä–æ–≤, —É–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏—Ä–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤");
            }

            if (carbsPercent < 45) {
                score -= 10;
                recommendations.push("–î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ —Å–ª–æ–∂–Ω—ã—Ö —É–≥–ª–µ–≤–æ–¥–æ–≤ (–∫—Ä—É–ø—ã, –æ–≤–æ—â–∏)");
            } else if (carbsPercent > 65) {
                score -= 15;
                recommendations.push("–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —É–≥–ª–µ–≤–æ–¥–æ–≤, —Å–±–∞–ª–∞–Ω—Å–∏—Ä—É–π—Ç–µ –±–µ–ª–∫–∞–º–∏ –∏ –∂–∏—Ä–∞–º–∏");
            }

            // –û—Ü–µ–Ω–∏–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∂–µ–ª–µ–∑–∞
            if (totalIron < 5) {
                score -= 10;
                recommendations.push("–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã, –±–æ–≥–∞—Ç—ã–µ –∂–µ–ª–µ–∑–æ–º (–ø–µ—á–µ–Ω—å, —à–ø–∏–Ω–∞—Ç, —á–µ—á–µ–≤–∏—Ü–∞)");
            } else if (totalIron > 20) {
                score -= 5;
                recommendations.push("–í—ã—Å–æ–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∂–µ–ª–µ–∑–∞, —á—Ç–æ —Ö–æ—Ä–æ—à–æ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏ –∞–Ω–µ–º–∏–∏");
            }

            // –û—Ü–µ–Ω–∏–≤–∞–µ–º —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
            if (recipe.ingredients.length < 3) {
                score -= 10;
                recommendations.push("–î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤");
            }

            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ—Ü–µ–Ω–∫—É –æ—Ç 0 –¥–æ 100
            score = Math.max(0, Math.min(100, score));

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥
            let rating, description, scoreClass;
            if (score >= 80) {
                rating = "–û—Ç–ª–∏—á–Ω–æ";
                description = "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏ –ø–æ–ª–µ–∑–Ω–æ–µ –±–ª—é–¥–æ";
                scoreClass = "score-excellent";
            } else if (score >= 60) {
                rating = "–•–æ—Ä–æ—à–æ";
                description = "–ù–µ–ø–ª–æ—Ö–æ–π –±–∞–ª–∞–Ω—Å, –µ—Å—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏";
                scoreClass = "score-good";
            } else {
                rating = "–ù—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å";
                description = "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ—Å—Ç–∞–≤ –±–ª—é–¥–∞";
                scoreClass = "score-poor";
            }

            // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
            const starRating = getStarRating(score);
            document.getElementById('starRating').innerHTML = starRating;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('analysisResult').style.display = 'block';
            document.getElementById('scoreCircle').textContent = Math.round(score);
            document.getElementById('scoreCircle').className = `score-circle ${scoreClass}`;
            document.getElementById('healthRating').textContent = rating;
            document.getElementById('healthDescription').textContent = description;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞—Ä—ã –ë–ñ–£
            document.getElementById('proteinBar').style.width = `${proteinPercent}%`;
            document.getElementById('fatBar').style.width = `${fatPercent}%`;
            document.getElementById('carbsBar').style.width = `${carbsPercent}%`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∏ –≤–µ—Å
            document.getElementById('proteinPercent').textContent = `${proteinPercent.toFixed(1)}%`;
            document.getElementById('proteinWeight').textContent = `${totalProtein.toFixed(1)}–≥`;
            document.getElementById('fatPercent').textContent = `${fatPercent.toFixed(1)}%`;
            document.getElementById('fatWeight').textContent = `${totalFat.toFixed(1)}–≥`;
            document.getElementById('carbsPercent').textContent = `${carbsPercent.toFixed(1)}%`;
            document.getElementById('carbsWeight').textContent = `${totalCarbs.toFixed(1)}–≥`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            const recommendationsList = document.getElementById('recommendationsList');
            recommendationsList.innerHTML = '';
            if (recommendations.length > 0) {
                recommendations.forEach(rec => {
                    const p = document.createElement('p');
                    p.textContent = `‚Ä¢ ${rec}`;
                    recommendationsList.appendChild(p);
                });
            } else {
                const p = document.createElement('p');
                p.textContent = "–û—Ç–ª–∏—á–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤!";
                recommendationsList.appendChild(p);
            }
        }

        function getStarRating(score) {
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ—Ü–µ–Ω–∫—É 0-100 –≤ –∑–≤–µ–∑–¥—ã 1-5
            let stars = '';
            const starCount = Math.max(1, Math.min(5, Math.round(score / 20)));
            
            for (let i = 0; i < starCount; i++) {
                stars += '‚≠ê';
            }
            
            return stars;
        }

        function addIngredient() {
            const container = document.getElementById('ingredients');
            const newRow = document.createElement('div');
            newRow.className = 'ingredient-row';
            newRow.innerHTML = `
                <input type="text" placeholder="–ü—Ä–æ–¥—É–∫—Ç" class="ingredient-name">
                <input type="number" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" class="ingredient-amount" value="100">
                <select class="ingredient-unit">
                    <option value="g">–≥</option>
                    <option value="ml">–º–ª</option>
                    <option value="tsp">—á.–ª.</option>
                    <option value="tbsp">—Å—Ç.–ª.</option>
                    <option value="cup">—Å—Ç–∞–∫–∞–Ω</option>
                    <option value="piece">—à—Ç.</option>
                </select>
                <input type="number" placeholder="–¶–µ–Ω–∞ –∑–∞ 100–≥/–º–ª" class="ingredient-price" step="0.01" min="0">
            `;
            container.appendChild(newRow);
        }

        function addRecipe() {
            const name = document.getElementById('recipeName').value;
            const category = document.getElementById('category').value;
            const instructions = document.getElementById('instructions').value;
            const ingredients = [];
            
            document.querySelectorAll('.ingredient-row').forEach(row => {
                const name = row.querySelector('.ingredient-name').value.toLowerCase();
                const amount = row.querySelector('.ingredient-amount').value;
                const unit = row.querySelector('.ingredient-unit').value;
                const price = row.querySelector('.ingredient-price').value;
                if (name && amount) ingredients.push({ 
                    name, 
                    amount: parseFloat(amount), 
                    unit,
                    price: price ? parseFloat(price) : 0
                });
            });

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞');
                return;
            }
            
            if (ingredients.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç');
                return;
            }

            const recipe = { 
                id: Date.now(), // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                name, 
                category, 
                ingredients,
                instructions,
                image: currentImageData // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            };
            
            recipes.push(recipe);
            localStorage.setItem('recipes', JSON.stringify(recipes));
            
            // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
            document.getElementById('recipeName').value = '';
            document.getElementById('instructions').value = '';
            document.getElementById('ingredients').innerHTML = `
                <div class="ingredient-row">
                    <input type="text" placeholder="–ü—Ä–æ–¥—É–∫—Ç" class="ingredient-name">
                    <input type="number" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" class="ingredient-amount" value="100">
                    <select class="ingredient-unit">
                        <option value="g">–≥</option>
                        <option value="ml">–º–ª</option>
                        <option value="tsp">—á.–ª.</option>
                        <option value="tbsp">—Å—Ç.–ª.</option>
                        <option value="cup">—Å—Ç–∞–∫–∞–Ω</option>
                        <option value="piece">—à—Ç.</option>
                    </select>
                    <input type="number" placeholder="–¶–µ–Ω–∞ –∑–∞ 100–≥/–º–ª" class="ingredient-price" step="0.01" min="0">
                </div>
            `;
            // –°–±—Ä–æ—Å–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            currentImageData = null;
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('imageUpload').querySelector('p').textContent = 'üì∑ –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ';
            document.getElementById('imageInput').value = '';
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤–∫–ª–∞–¥–∫—É —Å —Ä–µ—Ü–µ–ø—Ç–∞–º–∏
            showTab('recipes');
            calculateNutrition();
        }

        function calculateRecipeCost(recipe) {
            let totalCost = 0;
            let costBreakdown = [];
            
            recipe.ingredients.forEach(ing => {
                if (ing.price && ing.price > 0) {
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –≥—Ä–∞–º–º—ã
                    const weightInGrams = ing.amount * unitConversions[ing.unit];
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
                    const ingredientCost = (weightInGrams * ing.price) / 100;
                    totalCost += ingredientCost;
                    
                    costBreakdown.push({
                        name: ing.name,
                        cost: ingredientCost
                    });
                }
            });
            
            return {
                total: totalCost,
                breakdown: costBreakdown
            };
        }

        function deleteRecipe(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ä–µ—Ü–µ–ø—Ç?')) {
                recipes = recipes.filter(recipe => recipe.id !== id);
                localStorage.setItem('recipes', JSON.stringify(recipes));
                updateRecipesList();
                calculateNutrition();
            }
        }

        function viewRecipe(id) {
            const recipe = recipes.find(recipe => recipe.id === id);
            if (recipe) {
                openRecipeModal(recipe);
            }
        }

        function openRecipeModal(recipe) {
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è —ç—Ç–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞
            let totalProtein = 0;
            let totalFat = 0;
            let totalCarbs = 0;
            let totalIron = 0;
            let totalCalories = 0;

            recipe.ingredients.forEach(ing => {
                const food = foodDatabase[ing.name];
                if (food) {
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –≥—Ä–∞–º–º—ã
                    const weightInGrams = ing.amount * unitConversions[ing.unit];
                    const ratio = weightInGrams / 100;
                    totalProtein += food.protein * ratio;
                    totalFat += food.fat * ratio;
                    totalCarbs += food.carbs * ratio;
                    totalIron += food.iron * ratio;
                    totalCalories += food.calories * ratio;
                }
            });

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ—Ü–µ–ø—Ç–∞
            const costData = calculateRecipeCost(recipe);
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Ü–µ–Ω–∫—É –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏
            const score = calculateRecipeScore(recipe);
            const starRating = getStarRating(score);

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <h2>${recipe.name}</h2>
                <div class="category-tag">${getCategoryName(recipe.category)}</div>
                
                ${recipe.image ? `<img src="${recipe.image}" class="modal-recipe-image" alt="${recipe.name}">` : ''}
                
                <div class="modal-section">
                    <h3>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</h3>
                    <ul class="ingredients-list">
                        ${recipe.ingredients.map(ing => {
                            const unitName = getUnitName(ing.unit);
                            const priceInfo = ing.price && ing.price > 0 ? 
                                ` - ${((ing.amount * unitConversions[ing.unit] * ing.price) / 100).toFixed(2)} —Ä—É–±` : 
                                '';
                            return `<li>${ing.name} - ${ing.amount} ${unitName}${priceInfo}</li>`;
                        }).join('')}
                    </ul>
                </div>
                
                <div class="modal-section">
                    <h3>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ—Ü–µ–ø—Ç–∞</h3>
                    <div class="cost-summary">
                        <div class="cost-breakdown">
                            ${costData.breakdown.map(item => `
                                <div class="cost-item">
                                    <span>${item.name}</span>
                                    <span>${item.cost.toFixed(2)} —Ä—É–±</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="total-cost">
                            <span>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                            <span>${costData.total.toFixed(2)} —Ä—É–±</span>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>–û—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏</h3>
                    <div style="text-align: center; margin: 15px 0;">
                        <div class="stars" style="font-size: 28px;">${starRating}</div>
                        <p style="margin-top: 10px; color: #8e8e93;">${getHealthDescription(score)}</p>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>–°–ø–æ—Å–æ–± –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</h3>
                    <div class="instructions-text">${recipe.instructions || '–°–ø–æ—Å–æ–± –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω.'}</div>
                </div>
                
                <div class="modal-section">
                    <h3>–ü–∏—â–µ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å (–Ω–∞ –ø–æ—Ä—Ü–∏—é)</h3>
                    <div class="nutrition-facts">
                        <div class="nutrition-item">
                            <div class="nutrition-value">${Math.round(totalCalories)}</div>
                            <div class="nutrition-label">–ö–∞–ª–æ—Ä–∏–∏</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value">${totalProtein.toFixed(1)}</div>
                            <div class="nutrition-label">–ë–µ–ª–∫–∏ (–≥)</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value">${totalFat.toFixed(1)}</div>
                            <div class="nutrition-label">–ñ–∏—Ä—ã (–≥)</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value">${totalCarbs.toFixed(1)}</div>
                            <div class="nutrition-label">–£–≥–ª–µ–≤–æ–¥—ã (–≥)</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value">${totalIron.toFixed(2)}</div>
                            <div class="nutrition-label">–ñ–µ–ª–µ–∑–æ (–º–≥)</div>
                        </div>
                    </div>
                </div>
            `;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('recipeModal').style.display = 'block';
        }

        function calculateRecipeScore(recipe) {
            let totalProtein = 0;
            let totalFat = 0;
            let totalCarbs = 0;
            let totalIron = 0;
            let totalCalories = 0;

            recipe.ingredients.forEach(ing => {
                const food = foodDatabase[ing.name];
                if (food) {
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –≥—Ä–∞–º–º—ã
                    const weightInGrams = ing.amount * unitConversions[ing.unit];
                    const ratio = weightInGrams / 100;
                    totalProtein += food.protein * ratio;
                    totalFat += food.fat * ratio;
                    totalCarbs += food.carbs * ratio;
                    totalIron += food.iron * ratio;
                    totalCalories += food.calories * ratio;
                }
            });

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã –ë–ñ–£ –æ—Ç –æ–±—â–µ–π –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏
            const proteinCalories = totalProtein * 4;
            const fatCalories = totalFat * 9;
            const carbsCalories = totalCarbs * 4;
            const totalMacroCalories = proteinCalories + fatCalories + carbsCalories;
            
            // –ü—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç –æ–±—â–µ–π –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏
            const proteinPercent = totalMacroCalories > 0 ? (proteinCalories / totalMacroCalories) * 100 : 0;
            const fatPercent = totalMacroCalories > 0 ? (fatCalories / totalMacroCalories) * 100 : 0;
            const carbsPercent = totalMacroCalories > 0 ? (carbsCalories / totalMacroCalories) * 100 : 0;

            // –û—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏
            let score = 100;

            // –û—Ü–µ–Ω–∏–≤–∞–µ–º –±–∞–ª–∞–Ω—Å –ë–ñ–£
            if (proteinPercent < 15) score -= 15;
            else if (proteinPercent > 30) score -= 10;

            if (fatPercent < 20) score -= 10;
            else if (fatPercent > 40) score -= 15;

            if (carbsPercent < 45) score -= 10;
            else if (carbsPercent > 65) score -= 15;

            // –û—Ü–µ–Ω–∏–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∂–µ–ª–µ–∑–∞
            if (totalIron < 5) score -= 10;
            else if (totalIron > 20) score -= 5;

            // –û—Ü–µ–Ω–∏–≤–∞–µ–º —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
            if (recipe.ingredients.length < 3) score -= 10;

            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ—Ü–µ–Ω–∫—É –æ—Ç 0 –¥–æ 100
            return Math.max(0, Math.min(100, score));
        }

        function getHealthDescription(score) {
            if (score >= 80) return "–û—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ";
            if (score >= 60) return "–ü–æ–ª–µ–∑–Ω–æ";
            if (score >= 40) return "–£–º–µ—Ä–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ";
            if (score >= 20) return "–ú–∞–ª–æ –ø–æ–ª–µ–∑–Ω–æ";
            return "–û—á–µ–Ω—å –≤—Ä–µ–¥–Ω–æ";
        }

        function closeModal() {
            document.getElementById('recipeModal').style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('recipeModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        function calculateNutrition() {
            let totalCalories = 0;
            let totalIron = 0;
            let totalProtein = 0;
            let totalCarbs = 0;

            recipes.forEach(recipe => {
                recipe.ingredients.forEach(ing => {
                    const food = foodDatabase[ing.name];
                    if (food) {
                        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –≥—Ä–∞–º–º—ã
                        const weightInGrams = ing.amount * unitConversions[ing.unit];
                        const ratio = weightInGrams / 100;
                        totalCalories += food.calories * ratio;
                        totalIron += food.iron * ratio;
                        totalProtein += food.protein * ratio;
                        totalCarbs += food.carbs * ratio;
                    }
                });
            });

            document.getElementById('totalCalories').textContent = Math.round(totalCalories);
            document.getElementById('totalIron').textContent = totalIron.toFixed(2);
            document.getElementById('totalProtein').textContent = totalProtein.toFixed(1);
            document.getElementById('totalCarbs').textContent = totalCarbs.toFixed(1);
        }

        function updateRecipesList() {
            const container = document.getElementById('recipesList');
            container.innerHTML = '';
            
            if (recipes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>ü•ó –†–µ—Ü–µ–ø—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                        <p>–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —Ä–µ—Ü–µ–ø—Ç!</p>
                    </div>
                `;
                return;
            }
            
            recipes.forEach((recipe, index) => {
                // –í—ã–±–∏—Ä–∞–µ–º —Ü–≤–µ—Ç –¥–ª—è –ø–ª–∏—Ç–∫–∏ (—Ü–∏–∫–ª–∏—á–Ω–æ –∏–∑ –º–∞—Å—Å–∏–≤–∞ —Ü–≤–µ—Ç–æ–≤)
                const colorIndex = index % tileColors.length;
                const tileColor = tileColors[colorIndex];
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ—Ü–µ–ø—Ç–∞
                const costData = calculateRecipeCost(recipe);
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Ü–µ–Ω–∫—É –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏
                const score = calculateRecipeScore(recipe);
                const starRating = getStarRating(score);
                
                const tile = document.createElement('div');
                tile.className = 'recipe-tile';
                tile.style.background = tileColor;
                
                // –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–ª–∏—Ç–∫–∏
                tile.innerHTML = `
                    ${recipe.image ? `<img src="${recipe.image}" class="recipe-tile-image" alt="${recipe.name}">` : ''}
                    <div class="recipe-tile-content">
                        <div>
                            <div class="recipe-tile-category">${getCategoryName(recipe.category)}</div>
                            <div class="recipe-tile-title">${recipe.name}</div>
                        </div>
                        <div class="recipe-tile-info">
                            <div class="recipe-tile-rating">
                                <span class="stars">${starRating}</span>
                            </div>
                            <div class="recipe-tile-cost">${costData.total > 0 ? costData.total.toFixed(2) + ' —Ä—É–±' : '–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞'}</div>
                            <div>${recipe.ingredients.length} –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤</div>
                        </div>
                    </div>
                    <button class="delete-tile-btn" onclick="event.stopPropagation(); deleteRecipe(${recipe.id})">‚úï</button>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –ø–ª–∏—Ç–∫—É
                tile.addEventListener('click', function() {
                    viewRecipe(recipe.id);
                });
                
                container.appendChild(tile);
            });
        }

        function updateFoodList() {
            const container = document.getElementById('foodList');
            container.innerHTML = '';
            
            Object.keys(foodDatabase).forEach(food => {
                const li = document.createElement('li');
                li.textContent = food;
                container.appendChild(li);
            });
        }

        function getCategoryName(category) {
            const names = {
                'breakfast': '–ó–∞–≤—Ç—Ä–∞–∫',
                'lunch': '–û–±–µ–¥',
                'dinner': '–£–∂–∏–Ω',
                'snack': '–ü–µ—Ä–µ–∫—É—Å',
                'dessert': '–î–µ—Å–µ—Ä—Ç'
            };
            return names[category];
        }

        function getUnitName(unit) {
            const names = {
                'g': '–≥',
                'ml': '–º–ª',
                'tsp': '—á.–ª.',
                'tbsp': '—Å—Ç.–ª.',
                'cup': '—Å—Ç–∞–∫–∞–Ω',
                'piece': '—à—Ç.'
            };
            return names[unit];
        }
    </script>
</body>
</html>